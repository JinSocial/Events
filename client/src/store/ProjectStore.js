import ProjectService from "services/ProjectService";
import ModalStore from "store/ModalStore";
import { placemarkTypes } from "utils/utils";

const { makeAutoObservable } = require("mobx");

class ProjectStore {
    project = {
        title: "",
        point: null,
    };
    projects = [];
    projectsVisibleOptions = placemarkTypes.map(() => true);

    constructor() {
        makeAutoObservable(this);
    }

    async fetchProject(id) {
        this.setProject({
            id: id,
            title: "Очень крутая новость",
            image: "https://w-dog.ru/wallpapers/11/2/436430609124457/gory-ozero-zvezdy.jpg",
            text: "Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, Много текста, "
        });
    }

    setPoint(point) {
        this.project.point = point;
    }

    setProject(project) {
        this.project = project;
    }

    openProjectOffcanvas(project) {
        this.project = project;
        ModalStore.showProjectOffcanvas(true);
    }

    async create(title, description, endDate, type, callback) {
        try {
            await ProjectService.create(title, description, endDate, this.project.point, type);
            this.fetchProjects();
            callback(null);
        } catch (e) {
            console.log(e);
            callback(e);
        }
    }

    async fetchProjects() {
        try {
            const response = await ProjectService.getAll();
            this.setProjects(response.data);
        } catch (e) {
            console.error(e.message);
        }
    }

    setProjects(projects) {
        this.projects = projects;
    }

    setVisible(visible, type) {
        this.projectsVisibleOptions[type-1] = visible;
    }
}

export default new ProjectStore();